<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Döbelner Riesenstiefel - Community Galerie</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Gemeinsame Galerie für den Döbelner Riesenstiefel - Jetzt mitmachen!">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
  --bg:#0b0c10;
  --panel:#141621;
  --text:#ffffff;
  --muted:#9aa0b5;
  --accent:#5f7cff;
  --danger:#ff5252;
  --success:#4CAF50;
  --radius:18px;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:"Inter",system-ui,sans-serif}

body{
  background:var(--bg);
  color:var(--text);
  line-height:1.6;
  overflow-x: hidden;
}

/* NAV */
nav{
  position:fixed;
  top:0;
  width:100%;
  z-index:1000;
  background:rgba(11,12,16,.9);
  backdrop-filter:blur(12px);
  border-bottom:1px solid #1f2233;
}

.nav-inner{
  max-width:1200px;
  margin:auto;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.nav-logo{
  font-weight:700;
  font-size:1.1rem;
  display:flex;
  align-items:center;
  gap:10px;
}

.nav-logo i {
  color: var(--accent);
}

.nav-links a{
  color:var(--muted);
  text-decoration:none;
  margin-left:24px;
  font-weight:500;
}

.nav-links a:hover{color:#fff}

/* HERO */
header{
  min-height:100vh;
  padding-top:120px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  background:radial-gradient(circle at top,rgba(95,124,255,.25),transparent 60%);
}

header h1{
  font-size:clamp(2.8rem,6vw,4.2rem);
  margin-bottom:12px;
}

header p{
  max-width:600px;
  color:var(--muted);
}

.stats {
  display: flex;
  gap: 30px;
  margin-top: 30px;
  flex-wrap: wrap;
  justify-content: center;
}

.stat-box {
  background: rgba(95, 124, 255, 0.1);
  padding: 20px;
  border-radius: var(--radius);
  border: 1px solid rgba(95, 124, 255, 0.2);
  min-width: 180px;
}

.stat-box .number {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--accent);
  display: block;
}

.stat-box .label {
  color: var(--muted);
  font-size: 0.9rem;
}

/* SECTIONS */
section{
  padding:100px 8%;
}

h2{
  font-size:2.2rem;
  margin-bottom:14px;
}

p.section-text{
  color:var(--muted);
  max-width:700px;
  margin-bottom:32px;
}

.panel{
  background:var(--panel);
  border-radius:var(--radius);
  padding:32px;
}

/* GALLERY */
.gallery-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 15px;
}

.gallery-stats {
  background: rgba(95, 124, 255, 0.1);
  padding: 10px 20px;
  border-radius: 20px;
  font-size: 0.9rem;
}

.gallery-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:24px;
}

.image-card{
  background:#0c0d15;
  border-radius:14px;
  overflow:hidden;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  display: flex;
  flex-direction: column;
  position: relative;
}

.image-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

.image-card img{
  width:100%;
  height:220px;
  object-fit:cover;
  flex-grow: 1;
}

.image-card footer{
  padding:12px 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-top: 1px solid #1f2233;
  background: rgba(20,22,33,0.8);
}

.image-card .image-info {
  display: flex;
  flex-direction: column;
  gap: 5px;
  flex-grow: 1;
}

.image-card .image-comment {
  font-size: 0.85rem;
  color: #ccc;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 180px;
}

.image-card .delete-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.7);
  color: white;
  border: none;
  width: 35px;
  height: 35px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s;
}

.image-card:hover .delete-btn {
  opacity: 1;
}

.delete-btn:hover {
  background: var(--danger);
}

.like-btn{
  background:none;
  border:none;
  color:#fff;
  cursor:pointer;
  font-size:1rem;
  transition: transform 0.2s;
  display: flex;
  align-items: center;
  gap: 5px;
}

.like-btn:hover {
  transform: scale(1.2);
}

.like-btn.liked {
  color: #ff5252;
}

.upload-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-bottom: 20px;
  background: rgba(20,22,33,0.5);
  padding: 25px;
  border-radius: var(--radius);
  border: 1px solid #2a2f45;
}

.upload-form textarea {
  background: #0c0d15;
  border: 1px solid #2a2f45;
  border-radius: 10px;
  color: white;
  padding: 12px 15px;
  font-size: 1rem;
  font-family: "Inter", system-ui, sans-serif;
  resize: vertical;
  min-height: 80px;
  max-height: 200px;
  line-height: 1.5;
}

.upload-form textarea:focus {
  outline: none;
  border-color: var(--accent);
}

.upload-form button {
  align-self: flex-start;
}

.upload-hint {
  font-size: 0.85rem;
  color: var(--muted);
  margin-top: -10px;
}

/* GAME CONTAINER */
.game-container {
  position: relative;
  max-width: 900px;
  margin: 0 auto;
  width: 100%;
}

.game-wrapper {
  position: relative;
  width: 100%;
}

.game-controls {
  display: flex;
  gap: 12px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

canvas{
  width:100%;
  max-width:900px;
  height:400px;
  background:#0c0d15;
  border-radius:var(--radius);
  display:block;
  border: 2px solid #1f2233;
  touch-action: none;
  user-select: none;
}

.score{
  margin-top:12px;
  color:var(--muted);
  font-size: 1.1rem;
  font-weight: 600;
}

/* BUTTONS */
button.primary{
  background:var(--accent);
  border:none;
  color:#fff;
  padding:14px 26px;
  border-radius:999px;
  font-weight:600;
  cursor:pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

button.primary:hover {
  background: #4a6cff;
  transform: translateY(-2px);
}

button.secondary {
  background: #2a2f45;
  border: 1px solid #3a4160;
  color: #fff;
  padding: 14px 26px;
  border-radius: 999px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

button.secondary:hover {
  background: #3a4160;
}

button.danger {
  background: var(--danger);
  border: none;
  color: #fff;
  padding: 14px 26px;
  border-radius: 999px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

button.danger:hover {
  background: #ff3838;
}

.game-instructions {
  background: rgba(95, 124, 255, 0.1);
  border-radius: var(--radius);
  padding: 20px;
  margin-top: 20px;
  border: 1px solid rgba(95, 124, 255, 0.2);
}

.game-instructions h3 {
  color: var(--accent);
  margin-bottom: 10px;
}

.game-instructions ul {
  list-style: none;
  padding-left: 0;
}

.game-instructions li {
  margin-bottom: 8px;
  color: var(--muted);
  display: flex;
  align-items: center;
}

.game-instructions li:before {
  content: "•";
  color: var(--accent);
  font-weight: bold;
  margin-right: 10px;
}

/* FULLSCREEN STYLES */
.game-fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: var(--bg);
  z-index: 9999;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.game-fullscreen.active {
  display: flex;
}

.game-fullscreen canvas {
  width: 100%;
  height: 80%;
  max-width: 100%;
  border-radius: 0;
  border: none;
}

.game-fullscreen .fullscreen-controls {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 10px;
}

.game-fullscreen .fullscreen-score {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 1.5rem;
  color: white;
  font-weight: 600;
}

/* JUMP INDICATOR */
.jump-indicator {
  display: flex;
  align-items: center;
  margin-top: 10px;
  gap: 5px;
}

.jump-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #4CAF50;
  transition: all 0.2s;
}

.jump-dot.used {
  background: #ff5252;
  transform: scale(0.8);
}

/* IMAGE FULLSCREEN MODAL */
.image-fullscreen-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.95);
  z-index: 10000;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 40px;
}

.image-fullscreen-modal.active {
  display: flex;
}

.image-fullscreen-content {
  max-width: 90%;
  max-height: 80%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.image-fullscreen-content img {
  max-width: 100%;
  max-height: 70vh;
  object-fit: contain;
  border-radius: 10px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

.image-fullscreen-info {
  margin-top: 25px;
  text-align: center;
  max-width: 700px;
  width: 100%;
  background: rgba(20,22,33,0.8);
  padding: 20px;
  border-radius: 12px;
  border: 1px solid #2a2f45;
}

.image-fullscreen-info .likes {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(95, 124, 255, 0.2);
  padding: 8px 15px;
  border-radius: 20px;
  margin-bottom: 15px;
}

.image-fullscreen-info .comment {
  font-size: 1.2rem;
  color: #fff;
  font-style: italic;
  margin-top: 10px;
  line-height: 1.5;
  padding: 15px;
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.image-fullscreen-controls {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 15px;
  z-index: 10001;
}

.image-fullscreen-controls button {
  background: rgba(20,22,33,0.9);
  border: 1px solid #3a4160;
  color: white;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 1.2rem;
  transition: all 0.2s;
}

.image-fullscreen-controls button:hover {
  background: var(--accent);
  transform: scale(1.1);
}

.image-fullscreen-controls button.liked {
  color: #ff5252;
}

.nav-arrows {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  display: flex;
  justify-content: space-between;
  padding: 0 30px;
  z-index: 10001;
}

.nav-arrows button {
  background: rgba(20,22,33,0.9);
  border: 1px solid #3a4160;
  color: white;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 1.5rem;
  transition: all 0.2s;
}

.nav-arrows button:hover {
  background: var(--accent);
  transform: scale(1.1);
}

.no-comment {
  color: #888;
  font-style: italic;
}

footer.site{
  padding:40px;
  text-align:center;
  color:var(--muted);
}

/* Loading Animation */
.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
  color: var(--muted);
}

.spinner {
  border: 4px solid rgba(95, 124, 255, 0.2);
  border-top: 4px solid var(--accent);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin-bottom: 15px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
  .gallery-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  }
  
  .nav-arrows button {
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
  }
  
  .image-fullscreen-info {
    padding: 15px;
  }
  
  .image-fullscreen-info .comment {
    font-size: 1rem;
  }
  
  .stats {
    gap: 15px;
  }
  
  .stat-box {
    min-width: 140px;
    padding: 15px;
  }
  
  .stat-box .number {
    font-size: 2rem;
  }
}

/* Notification */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--accent);
  color: white;
  padding: 15px 25px;
  border-radius: var(--radius);
  z-index: 10001;
  display: flex;
  align-items: center;
  gap: 10px;
  transform: translateX(120%);
  transition: transform 0.3s;
}

.notification.show {
  transform: translateX(0);
}

.notification.error {
  background: var(--danger);
}

.notification.success {
  background: var(--success);
}
</style>
</head>

<body>

<div id="notification" class="notification">
  <i class="fas fa-info-circle"></i>
  <span id="notificationText"></span>
</div>

<nav>
  <div class="nav-inner">
    <div class="nav-logo">
      <i class="fas fa-boot"></i>
      Döbelner Riesenstiefel
    </div>
    <div class="nav-links">
      <a href="#galerie">Community Galerie</a>
      <a href="#spiel">Stiefel-Spiel</a>
      <a href="#entfernung">Entfernung</a>
    </div>
  </div>
</nav>

<header>
  <h1>Community Galerie</h1>
  <p>Teile deine Bilder vom Döbelner Riesenstiefel mit der ganzen Welt! Jeder kann Bilder sehen, liken und kommentieren.</p>
  
  <div class="stats">
    <div class="stat-box">
      <span class="number" id="totalImages">0</span>
      <span class="label">Bilder insgesamt</span>
    </div>
    <div class="stat-box">
      <span class="number" id="totalLikes">0</span>
      <span class="label">Likes gesamt</span>
    </div>
    <div class="stat-box">
      <span class="number" id="activeUsers">0</span>
      <span class="label">Aktive Nutzer</span>
    </div>
  </div>
</header>

<section id="galerie">
<div class="gallery-header">
  <div>
    <h2>Community Galerie</h2>
    <p class="section-text">Jeder kann Bilder hochladen, liken und kommentieren. Echtzeit für alle sichtbar!</p>
  </div>
  <div class="gallery-stats">
    <span id="onlineCount">0</span> Bilder online
  </div>
</div>

<div class="panel">
  <div class="upload-form">
    <h3><i class="fas fa-upload"></i> Neues Bild hochladen</h3>
    <input type="file" accept="image/*" id="upload">
    <textarea id="imageComment" placeholder="Füge einen Kommentar hinzu... z.B. 'Mein Besuch im Sommer 2024!'" maxlength="500"></textarea>
    <div class="upload-hint">
      <i class="fas fa-info-circle"></i> Das Bild ist sofort für alle sichtbar! Max. 5MB pro Bild.
    </div>
    <button class="primary" id="uploadBtn">
      <i class="fas fa-cloud-upload-alt"></i> Für alle hochladen
    </button>
  </div>
  
  <div id="galleryLoading" class="loading">
    <div class="spinner"></div>
    <p>Lade Community-Bilder...</p>
  </div>
  
  <div class="gallery-grid" id="gallery"></div>
</div>
</section>

<section id="spiel">
<h2><i class="fas fa-gamepad"></i> Stiefel Run</h2>
<p class="section-text">Springe mit dem Stiefel über Hindernisse. Geschwindigkeit steigt. Highscore wird gespeichert.</p>

<div class="game-container">
  <div class="game-controls">
    <button class="primary" id="fullscreenBtn">
      <i class="fas fa-expand"></i> Vollbild
    </button>
    <button class="secondary" id="startBtn">
      <i class="fas fa-play"></i> Spiel starten
    </button>
    <button class="secondary" id="pauseBtn">
      <i class="fas fa-pause"></i> Pause
    </button>
  </div>
  
  <div class="game-wrapper">
    <canvas id="game" width="900" height="400"></canvas>
    <div class="score" id="scoreText">Score: 0 | Highscore: 0</div>
    <div class="jump-indicator">
      <span style="margin-right: 8px;">Sprünge:</span>
      <div class="jump-dot" id="jump1"></div>
      <div class="jump-dot" id="jump2"></div>
    </div>
  </div>
  
  <div class="game-instructions">
    <h3><i class="fas fa-keyboard"></i> Steuerung</h3>
    <ul>
      <li><strong>LEERTASTE / PFEIL HOCH / Klick / Touch</strong> - Springen (2 Sprünge möglich)</li>
      <li><strong>F</strong> - Vollbildmodus für das Spiel</li>
      <li><strong>P</strong> - Spiel pausieren/fortsetzen</li>
      <li><strong>R</strong> - Spiel neu starten</li>
      <li><strong>ESC</strong> - Vollbild beenden</li>
    </ul>
  </div>
</div>

<!-- Vollbild Container (nur für Spiel) -->
<div class="game-fullscreen" id="fullscreenGame">
  <div class="fullscreen-controls">
    <button class="primary" id="exitFullscreenBtn">
      <i class="fas fa-compress"></i> Vollbild beenden
    </button>
    <button class="secondary" id="fsPauseBtn">
      <i class="fas fa-pause"></i> Pause
    </button>
  </div>
  <div class="fullscreen-score" id="fullscreenScore">Score: 0</div>
  <canvas id="fullscreenCanvas"></canvas>
</div>
</section>

<!-- Bild-Vollbild-Modal -->
<div class="image-fullscreen-modal" id="imageFullscreenModal">
  <div class="image-fullscreen-controls">
    <button id="imageDeleteBtn" title="Bild löschen">
      <i class="fas fa-trash"></i>
    </button>
    <button id="imageLikeBtn" title="Gefällt mir">
      <i class="far fa-heart"></i>
    </button>
    <button id="closeImageModal" title="Schließen">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="nav-arrows">
    <button id="prevImageBtn" title="Vorheriges Bild">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button id="nextImageBtn" title="Nächstes Bild">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
  
  <div class="image-fullscreen-content">
    <img id="fullscreenImage" src="" alt="Community Bild">
    <div class="image-fullscreen-info">
      <div class="likes" id="fullscreenLikes">
        <i class="fas fa-heart"></i> <span id="likeCount">0</span> Likes
      </div>
      <div class="comment" id="fullscreenComment">
        <span id="commentText"></span>
      </div>
      <div style="margin-top: 10px; font-size: 0.9rem; color: #888;">
        <i class="fas fa-user"></i> <span id="uploaderInfo"></span>
      </div>
    </div>
  </div>
</div>

<section id="entfernung">
<h2><i class="fas fa-map-marker-alt"></i> Entfernung zum Döbelner Riesenstiefel</h2>
<p class="section-text">Wie weit bist du vom originalen Döbelner Riesenstiefel entfernt?</p>

<div class="panel">
<button class="primary" onclick="calcDistance()">
  <i class="fas fa-location-arrow"></i> Entfernung berechnen
</button>
<p id="distanceOut" style="margin-top:14px;"></p>
</div>
</section>

<footer class="site">
  <p>©️ 2026 Döbelner Riesenstiefel Community</p>
  <p style="margin-top: 10px; font-size: 0.9rem;">
    <i class="fas fa-users"></i> Diese Galerie wird von der Community für die Community betrieben
  </p>
</footer>

<script>
// ===== BENUTZER ID =====
let userId = localStorage.getItem('stiefel_user_id');
if (!userId) {
  userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  localStorage.setItem('stiefel_user_id', userId);
}

// ===== LOKALER SPEICHER FÜR BILDER =====
const STORAGE_KEY = 'stiefel_community_images';

// Funktionen für lokale Speicherung
function getStoredImages() {
  const stored = localStorage.getItem(STORAGE_KEY);
  return stored ? JSON.parse(stored) : [];
}

function saveImages(images) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(images));
}

function updateImage(imageId, updates) {
  const images = getStoredImages();
  const index = images.findIndex(img => img.id === imageId);
  if (index !== -1) {
    images[index] = { ...images[index], ...updates };
    saveImages(images);
    return images[index];
  }
  return null;
}

function deleteStoredImage(imageId) {
  const images = getStoredImages();
  const filtered = images.filter(img => img.id !== imageId);
  saveImages(filtered);
  return filtered;
}

// ===== BENACHRICHTIGUNGEN =====
function showNotification(message, type = 'info') {
  const notification = document.getElementById('notification');
  const text = document.getElementById('notificationText');
  
  text.textContent = message;
  notification.className = 'notification';
  notification.classList.add(type);
  notification.classList.add('show');
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

// ===== GALERIE FUNKTIONEN =====
const upload = document.getElementById("upload");
const uploadBtn = document.getElementById("uploadBtn");
const imageComment = document.getElementById("imageComment");
const gallery = document.getElementById("gallery");
const galleryLoading = document.getElementById("galleryLoading");

let allImages = [];
let currentImageIndex = 0;

// Lade alle Bilder aus dem lokalen Speicher
function loadImages() {
  try {
    galleryLoading.style.display = 'flex';
    gallery.innerHTML = '';
    
    allImages = getStoredImages();
    
    // Statistik aktualisieren
    document.getElementById('totalImages').textContent = allImages.length;
    document.getElementById('onlineCount').textContent = allImages.length;
    
    let totalLikes = 0;
    let uniqueUsers = new Set();
    
    allImages.forEach(img => {
      totalLikes += img.likes || 0;
      if (img.user_id) uniqueUsers.add(img.user_id);
    });
    
    document.getElementById('totalLikes').textContent = totalLikes;
    document.getElementById('activeUsers').textContent = uniqueUsers.size;
    
    renderGallery();
    galleryLoading.style.display = 'none';
    
  } catch (error) {
    console.error('Fehler beim Laden:', error);
    showNotification('Fehler beim Laden der Bilder', 'error');
    galleryLoading.style.display = 'none';
  }
}

// Prüfe ob Benutzer Bild geliked hat
function hasUserLiked(image) {
  return image.liked_by && image.liked_by.includes(userId);
}

// Rendere Galerie
function renderGallery() {
  gallery.innerHTML = "";
  
  if (allImages.length === 0) {
    gallery.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--muted);">
        <i class="fas fa-images" style="font-size: 3rem; margin-bottom: 15px;"></i>
        <h3>Noch keine Bilder</h3>
        <p>Sei der/die Erste und lade ein Bild hoch!</p>
      </div>
    `;
    return;
  }
  
  allImages.forEach((img, i) => {
    const card = document.createElement("div");
    card.className = "image-card";
    
    const userLiked = hasUserLiked(img);
    const isUploader = img.user_id === userId;
    
    card.innerHTML = `
      <img src="${img.image_url}" alt="Community Bild" loading="lazy">
      ${isUploader ? `<button class="delete-btn" onclick="deleteImage('${img.id}', event)"><i class="fas fa-trash"></i></button>` : ''}
      <footer>
        <div class="image-info">
          <span>${img.likes || 0} ${img.likes === 1 ? 'Like' : 'Likes'}</span>
          ${img.comment ? `<div class="image-comment" title="${img.comment.replace(/"/g, '&quot;')}">${img.comment}</div>` : '<div class="image-comment">Kein Kommentar</div>'}
        </div>
        <button class="like-btn ${userLiked ? 'liked' : ''}" onclick="toggleLike('${img.id}', event)">
          ${userLiked ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>'}
        </button>
      </footer>`;
    
    card.addEventListener("click", (e) => {
      if (!e.target.closest('button')) {
        openImageFullscreen(i);
      }
    });
    
    gallery.appendChild(card);
  });
}

// Bild hochladen
function uploadImage() {
  const file = upload.files[0];
  if (!file) {
    showNotification('Bitte wähle zuerst ein Bild aus!', 'error');
    return;
  }
  
  // Dateigröße überprüfen
  if (file.size > 5 * 1024 * 1024) {
    showNotification('Das Bild ist zu groß! Maximale Größe: 5MB', 'error');
    return;
  }
  
  // Base64 konvertieren
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const newImage = {
        id: 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        image_url: reader.result,
        likes: 0,
        liked_by: [],
        comment: imageComment.value.trim(),
        user_id: userId,
        created_at: Date.now()
      };
      
      // Zu bestehenden Bildern hinzufügen
      const images = getStoredImages();
      images.unshift(newImage); // Neueste zuerst
      saveImages(images);
      
      showNotification('Bild erfolgreich hochgeladen! Für alle sichtbar.', 'success');
      
      // Formular zurücksetzen
      upload.value = "";
      imageComment.value = "";
      
      // Bilder neu laden
      loadImages();
      
    } catch (error) {
      console.error('Upload Fehler:', error);
      showNotification('Fehler beim Hochladen', 'error');
    }
  };
  
  reader.readAsDataURL(file);
}

// Like toggeln
function toggleLike(imageId, event) {
  if (event) event.stopPropagation();
  
  try {
    const imageIndex = allImages.findIndex(img => img.id === imageId);
    if (imageIndex === -1) return;
    
    const image = allImages[imageIndex];
    const userLiked = hasUserLiked(image);
    
    let newLikedBy = image.liked_by || [];
    let newLikes = image.likes || 0;
    
    if (userLiked) {
      // Like entfernen
      newLikedBy = newLikedBy.filter(id => id !== userId);
      newLikes = Math.max(0, newLikes - 1);
    } else {
      // Like hinzufügen
      newLikedBy.push(userId);
      newLikes += 1;
    }
    
    // Im lokalen Speicher aktualisieren
    const updatedImage = updateImage(imageId, {
      likes: newLikes,
      liked_by: newLikedBy
    });
    
    if (updatedImage) {
      allImages[imageIndex] = updatedImage;
    }
    
    // Statistik aktualisieren
    const totalLikes = allImages.reduce((sum, img) => sum + (img.likes || 0), 0);
    document.getElementById('totalLikes').textContent = totalLikes;
    
    renderGallery();
    
    // Wenn im Vollbild, aktualisieren
    if (imageFullscreenModal.classList.contains("active") && currentImageIndex === imageIndex) {
      updateFullscreenInfo();
    }
    
  } catch (error) {
    console.error('Like Fehler:', error);
    showNotification('Fehler beim Liken', 'error');
  }
}

// Bild löschen
function deleteImage(imageId, event) {
  if (event) event.stopPropagation();
  
  if (!confirm('Bist du sicher, dass du dieses Bild löschen möchtest? Das kann nicht rückgängig gemacht werden.')) {
    return;
  }
  
  try {
    const newImages = deleteStoredImage(imageId);
    allImages = newImages;
    
    showNotification('Bild erfolgreich gelöscht', 'success');
    loadImages();
    
    // Wenn das gelöschte Bild im Vollbild war, schließen
    if (imageFullscreenModal.classList.contains("active")) {
      closeImageFullscreen();
    }
    
  } catch (error) {
    console.error('Lösch Fehler:', error);
    showNotification('Fehler beim Löschen', 'error');
  }
}

// Event Listener
uploadBtn.addEventListener("click", uploadImage);

// ===== BILD-VOLLBILD-MODAL =====
const imageFullscreenModal = document.getElementById("imageFullscreenModal");
const fullscreenImage = document.getElementById("fullscreenImage");
const likeCount = document.getElementById("likeCount");
const commentText = document.getElementById("commentText");
const uploaderInfo = document.getElementById("uploaderInfo");
const closeImageModal = document.getElementById("closeImageModal");
const prevImageBtn = document.getElementById("prevImageBtn");
const nextImageBtn = document.getElementById("nextImageBtn");
const imageLikeBtn = document.getElementById("imageLikeBtn");
const imageDeleteBtn = document.getElementById("imageDeleteBtn");

function openImageFullscreen(index) {
  currentImageIndex = index;
  updateFullscreenInfo();
  imageFullscreenModal.classList.add("active");
  document.body.style.overflow = "hidden";
}

function updateFullscreenInfo() {
  const currentImage = allImages[currentImageIndex];
  if (!currentImage) return;
  
  fullscreenImage.src = currentImage.image_url;
  likeCount.textContent = currentImage.likes || 0;
  
  // Like-Button Status
  if (hasUserLiked(currentImage)) {
    imageLikeBtn.classList.add("liked");
    imageLikeBtn.innerHTML = '<i class="fas fa-heart"></i>';
  } else {
    imageLikeBtn.classList.remove("liked");
    imageLikeBtn.innerHTML = '<i class="far fa-heart"></i>';
  }
  
  // Kommentar
  if (currentImage.comment) {
    commentText.textContent = currentImage.comment;
    commentText.classList.remove("no-comment");
  } else {
    commentText.textContent = "Kein Kommentar vorhanden";
    commentText.classList.add("no-comment");
  }
  
  // Uploader Info
  const isUploader = currentImage.user_id === userId;
  uploaderInfo.textContent = isUploader ? 'Du hast dieses Bild hochgeladen' : 'Von einem Community-Mitglied';
  
  // Lösch-Button nur für Uploader anzeigen
  imageDeleteBtn.style.display = isUploader ? 'flex' : 'none';
}

function closeImageFullscreen() {
  imageFullscreenModal.classList.remove("active");
  document.body.style.overflow = "auto";
}

function navigateImage(direction) {
  if (allImages.length === 0) return;
  
  currentImageIndex += direction;
  
  if (currentImageIndex < 0) {
    currentImageIndex = allImages.length - 1;
  } else if (currentImageIndex >= allImages.length) {
    currentImageIndex = 0;
  }
  
  updateFullscreenInfo();
}

// Event Listener
closeImageModal.addEventListener("click", closeImageFullscreen);
prevImageBtn.addEventListener("click", () => navigateImage(-1));
nextImageBtn.addEventListener("click", () => navigateImage(1));
imageLikeBtn.addEventListener("click", () => {
  if (allImages[currentImageIndex]) {
    toggleLike(allImages[currentImageIndex].id);
  }
});
imageDeleteBtn.addEventListener("click", () => {
  if (allImages[currentImageIndex]) {
    deleteImage(allImages[currentImageIndex].id);
  }
});

// Tastatur-Steuerung
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && imageFullscreenModal.classList.contains("active")) {
    closeImageFullscreen();
  }
  
  if (imageFullscreenModal.classList.contains("active")) {
    if (e.key === "ArrowLeft") navigateImage(-1);
    if (e.key === "ArrowRight") navigateImage(1);
  }
});

// Klick außerhalb schließt Modal
imageFullscreenModal.addEventListener("click", (e) => {
  if (e.target === imageFullscreenModal) {
    closeImageFullscreen();
  }
});

// ===== SPIEL CODE =====
let canvas = document.getElementById("game");
let ctx = canvas.getContext("2d");
let fullscreenCanvas = document.getElementById("fullscreenCanvas");
let fsCtx = fullscreenCanvas.getContext("2d");

// Spiel-Variablen
let gameRunning = false;
let gamePaused = false;
let score = 0;
let highscore = localStorage.getItem('stiefel_highscore') || 0;
let speed = 5;
let obstacles = [];
let lastObstacleTime = 0;
let obstacleInterval = 1500;
let gameTime = 0;

// Stiefel-Variablen
let boot = {
  x: 100,
  y: canvas.height - 100,
  width: 60,
  height: 40,
  velocityY: 0,
  gravity: 0.8,
  jumpPower: -15,
  jumps: 0,
  maxJumps: 2,
  isJumping: false
};

// Vollbild-Variablen
let isFullscreen = false;
let activeCanvas = canvas;
let activeCtx = ctx;

// Initialisierung
document.getElementById("scoreText").textContent = `Score: ${score} | Highscore: ${highscore}`;

// Update Jump-Anzeige
function updateJumpIndicator() {
  document.getElementById("jump1").className = boot.jumps >= 1 ? "jump-dot used" : "jump-dot";
  document.getElementById("jump2").className = boot.jumps >= 2 ? "jump-dot used" : "jump-dot";
}

// Zeichne Stiefel
function drawBoot() {
  activeCtx.fillStyle = "#5f7cff";
  activeCtx.beginPath();
  activeCtx.roundRect(boot.x, boot.y, boot.width, boot.height, 10);
  activeCtx.fill();
  
  // Stiefel-Details
  activeCtx.fillStyle = "#3a5bff";
  activeCtx.beginPath();
  activeCtx.roundRect(boot.x + 10, boot.y - 10, 40, 15, 5);
  activeCtx.fill();
}

// Zeichne Hindernisse
function drawObstacles() {
  obstacles.forEach(obstacle => {
    activeCtx.fillStyle = obstacle.color || "#ff5252";
    activeCtx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
  });
}

// Zeichne Hintergrund
function drawBackground() {
  // Boden
  activeCtx.fillStyle = "#1f2233";
  activeCtx.fillRect(0, canvas.height - 30, activeCanvas.width, 30);
  
  // Wolken im Hintergrund
  activeCtx.fillStyle = "rgba(255, 255, 255, 0.1)";
  for (let i = 0; i < 3; i++) {
    let x = (activeCanvas.width / 3 * i + gameTime * 0.5) % (activeCanvas.width + 200) - 100;
    activeCtx.beginPath();
    activeCtx.arc(x, 80, 30, 0, Math.PI * 2);
    activeCtx.arc(x + 40, 70, 40, 0, Math.PI * 2);
    activeCtx.arc(x + 80, 80, 30, 0, Math.PI * 2);
    activeCtx.fill();
  }
}

// Kollisionserkennung
function checkCollision(rect1, rect2) {
  return rect1.x < rect2.x + rect2.width &&
         rect1.x + rect1.width > rect2.x &&
         rect1.y < rect2.y + rect2.height &&
         rect1.y + rect1.height > rect2.y;
}

// Spiel-Loop
function gameLoop() {
  if (!gameRunning || gamePaused) return;
  
  // Canvas löschen
  activeCtx.clearRect(0, 0, activeCanvas.width, activeCanvas.height);
  
  // Hintergrund zeichnen
  drawBackground();
  
  // Stiefel-Physik
  boot.velocityY += boot.gravity;
  boot.y += boot.velocityY;
  
  // Bodenkollision
  if (boot.y > activeCanvas.height - boot.height - 30) {
    boot.y = activeCanvas.height - boot.height - 30;
    boot.velocityY = 0;
    boot.jumps = 0;
    boot.isJumping = false;
  }
  
  // Hindernis-Physik
  obstacles.forEach((obstacle, index) => {
    obstacle.x -= speed;
    
    // Entferne Hindernisse die außerhalb sind
    if (obstacle.x + obstacle.width < 0) {
      obstacles.splice(index, 1);
      score += 10;
    }
    
    // Kollisionserkennung
    if (checkCollision(boot, obstacle)) {
      gameOver();
      return;
    }
  });
  
  // Neue Hindernisse generieren
  let currentTime = Date.now();
  if (currentTime - lastObstacleTime > obstacleInterval) {
    createObstacle();
    lastObstacleTime = currentTime;
  }
  
  // Geschwindigkeit erhöhen
  gameTime += 16;
  if (gameTime % 5000 === 0) {
    speed += 0.5;
    obstacleInterval = Math.max(600, obstacleInterval - 50);
  }
  
  // Zeichne alle Elemente
  drawBoot();
  drawObstacles();
  
  // Score anzeigen
  let scoreText = `Score: ${score}`;
  if (!isFullscreen) {
    scoreText += ` | Highscore: ${highscore}`;
  }
  
  document.getElementById("scoreText").textContent = scoreText;
  if (isFullscreen) {
    document.getElementById("fullscreenScore").textContent = `Score: ${score}`;
  }
  
  // Jump-Anzeige aktualisieren
  updateJumpIndicator();
  
  // Nächster Frame
  requestAnimationFrame(gameLoop);
}

// Hindernis erstellen
function createObstacle() {
  let height = Math.random() * 60 + 30;
  let type = Math.floor(Math.random() * 3);
  let colors = ["#ff5252", "#ff9f43", "#10ac84"];
  
  obstacles.push({
    x: activeCanvas.width,
    y: activeCanvas.height - height - 30,
    width: 30,
    height: height,
    color: colors[type]
  });
}

// Spiel starten
function startGame() {
  if (gameRunning) return;
  
  // Zurücksetzen
  score = 0;
  speed = 5;
  obstacles = [];
  boot.y = canvas.height - 100;
  boot.velocityY = 0;
  boot.jumps = 0;
  boot.isJumping = false;
  gameTime = 0;
  obstacleInterval = 1500;
  
  gameRunning = true;
  gamePaused = false;
  
  // Starten
  gameLoop();
  
  showNotification("Spiel gestartet! Springe mit Leertaste oder Klick.", "success");
}

// Spiel pausieren
function togglePause() {
  if (!gameRunning) return;
  
  gamePaused = !gamePaused;
  
  if (!gamePaused) {
    gameLoop();
    showNotification("Spiel fortgesetzt", "info");
  } else {
    showNotification("Spiel pausiert", "info");
  }
}

// Spiel beenden
function gameOver() {
  gameRunning = false;
  
  // Highscore speichern
  if (score > highscore) {
    highscore = score;
    localStorage.setItem('stiefel_highscore', highscore);
    showNotification(`Neuer Highscore: ${score}!`, "success");
  } else {
    showNotification(`Spiel beendet! Score: ${score}`, "error");
  }
  
  document.getElementById("scoreText").textContent = `Score: ${score} | Highscore: ${highscore}`;
}

// Spring-Funktion
function jump() {
  if (!gameRunning || gamePaused) return;
  
  if (boot.jumps < boot.maxJumps) {
    boot.velocityY = boot.jumpPower;
    boot.jumps++;
    boot.isJumping = true;
    
    // Sound-Effekt simulieren
    console.log("Jump!");
  }
}

// Vollbild umschalten
function toggleFullscreen() {
  const fullscreenGame = document.getElementById("fullscreenGame");
  
  if (!isFullscreen) {
    // In Vollbild wechseln
    fullscreenGame.classList.add("active");
    document.body.style.overflow = "hidden";
    
    // Canvas-Größe anpassen
    fullscreenCanvas.width = window.innerWidth;
    fullscreenCanvas.height = window.innerHeight - 100;
    
    // Aktiven Canvas wechseln
    activeCanvas = fullscreenCanvas;
    activeCtx = fsCtx;
    
    // Stiefel-Position anpassen
    boot.y = activeCanvas.height - 100;
    
    isFullscreen = true;
  } else {
    // Vollbild beenden
    fullscreenGame.classList.remove("active");
    document.body.style.overflow = "auto";
    
    // Aktiven Canvas wechseln
    activeCanvas = canvas;
    activeCtx = ctx;
    
    // Stiefel-Position zurücksetzen
    boot.y = canvas.height - 100;
    
    isFullscreen = false;
  }
  
  // Hindernisse zurücksetzen
  obstacles = [];
}

// Event Listener für Steuerung
document.addEventListener("keydown", (e) => {
  switch (e.key) {
    case " ":
    case "ArrowUp":
      e.preventDefault();
      jump();
      break;
    case "f":
    case "F":
      toggleFullscreen();
      break;
    case "p":
    case "P":
      togglePause();
      break;
    case "r":
    case "R":
      startGame();
      break;
    case "Escape":
      if (isFullscreen) {
        toggleFullscreen();
      }
      break;
  }
});

// Maus/Touch-Steuerung
activeCanvas.addEventListener("click", jump);
activeCanvas.addEventListener("touchstart", (e) => {
  e.preventDefault();
  jump();
});

// Steuerungs-Buttons
document.getElementById("startBtn").addEventListener("click", startGame);
document.getElementById("pauseBtn").addEventListener("click", togglePause);
document.getElementById("fullscreenBtn").addEventListener("click", toggleFullscreen);
document.getElementById("exitFullscreenBtn").addEventListener("click", toggleFullscreen);
document.getElementById("fsPauseBtn").addEventListener("click", togglePause);

// ===== DISTANCE CALCULATION =====
function calcDistance() {
  const stiefelPosition = { lat: 51.122, lng: 13.115 }; // Döbeln Koordinaten (ungefähr)
  
  if (!navigator.geolocation) {
    document.getElementById("distanceOut").innerHTML = 
      "<span style='color:var(--danger)'>Geolocation wird von deinem Browser nicht unterstützt.</span>";
    return;
  }
  
  document.getElementById("distanceOut").innerHTML = 
    "<i class='fas fa-spinner fa-spin'></i> Berechne Entfernung...";
  
  navigator.geolocation.getCurrentPosition(
    (position) => {
      const userLat = position.coords.latitude;
      const userLng = position.coords.longitude;
      
      // Haversine-Formel für Entfernungsberechnung
      const R = 6371; // Erdradius in km
      const dLat = (stiefelPosition.lat - userLat) * Math.PI / 180;
      const dLng = (stiefelPosition.lng - userLng) * Math.PI / 180;
      const a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(userLat * Math.PI / 180) * Math.cos(stiefelPosition.lat * Math.PI / 180) * 
        Math.sin(dLng/2) * Math.sin(dLng/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      const distance = R * c;
      
      document.getElementById("distanceOut").innerHTML = 
        `<span style="color:var(--accent)">Du bist ${distance.toFixed(1)} km vom Döbelner Riesenstiefel entfernt.</span>`;
      
      showNotification(`Entfernung berechnet: ${distance.toFixed(1)} km`, "success");
    },
    (error) => {
      let message = "Standort konnte nicht ermittelt werden.";
      switch(error.code) {
        case error.PERMISSION_DENIED:
          message = "Standort-Zugriff wurde verweigert.";
          break;
        case error.POSITION_UNAVAILABLE:
          message = "Standortinformationen sind nicht verfügbar.";
          break;
        case error.TIMEOUT:
          message = "Zeitüberschreitung bei der Standortabfrage.";
          break;
      }
      document.getElementById("distanceOut").innerHTML = 
        `<span style='color:var(--danger)'>${message}</span>`;
      showNotification(message, "error");
    }
  );
}

// ===== INITIALISIERUNG =====
document.addEventListener('DOMContentLoaded', () => {
  loadImages();
  
  // Füge Beispielbilder hinzu, wenn keine vorhanden sind
  if (getStoredImages().length === 0) {
    const exampleImages = [
      {
        id: 'example1',
        image_url: 'https://images.unsplash.com/photo-1543163521-1bf539c55dd2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
        likes: 12,
        liked_by: [],
        comment: 'Mein Besuch im Frühling 2024! Der Stiefel war gigantisch!',
        user_id: 'example_user',
        created_at: Date.now() - 86400000
      },
      {
        id: 'example2',
        image_url: 'https://images.unsplash.com/photo-1560343090-f0409e92791a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
        likes: 8,
        liked_by: [],
        comment: 'Bei Nacht besonders beeindruckend!',
        user_id: 'example_user2',
        created_at: Date.now() - 172800000
      }
    ];
    
    saveImages(exampleImages);
    loadImages();
  }
});

// Initialisiere Jump-Anzeige
updateJumpIndicator();

// Zeichne Startbildschirm
drawBackground();
drawBoot();
ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
ctx.fillRect(0, 0, canvas.width, canvas.height);
ctx.fillStyle = "#fff";
ctx.font = "30px Inter";
ctx.textAlign = "center";
ctx.fillText("STIEFEL RUN", canvas.width/2, canvas.height/2 - 30);
ctx.font = "18px Inter";
ctx.fillText("Klicke 'Spiel starten' oder drücke Leertaste", canvas.width/2, canvas.height/2 + 20);
</script>
</body>
</html>